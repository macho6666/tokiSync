# ☁️ TokiSync (토끼싱크)

**북토끼, 뉴토끼, 마나토끼**의 콘텐츠를 **구글 드라이브로 직접 업로드**하고, **전용 웹 대시보드(TokiView)**를 통해 편리하게 관리/열람할 수 있는 올인원 솔루션입니다.

> **Original Idea by:** hehaho (tokiDownloader)  
> **Rewritten & Enhanced by:** pray4skylark

-----

## ✨ 주요 기능

### 📥 수집기 (Client) - v1.6.2
*   **☁️ 구글 드라이브 직통 업로드:** PC 저장공간을 거치지 않고 메모리에서 바로 구글 드라이브로 전송합니다.
*   **🔄 스마트 동기화:** 버튼 하나로 **"아직 받지 않은 회차"**만 자동으로 골라내어 다운로드합니다.
*   **⚡️ 고속 병렬 처리:** 이미지 5장 동시 다운로드(Batch) 및 업로드 파이프라이닝으로 속도를 극대화했습니다.
*   **🛡️ 강력한 차단 회피:**
    *   **백그라운드 생존:** 탭을 내려놔도 멈추지 않도록 오디오 트릭(Oscillator)을 사용합니다.
    *   **캡차 감지:** 캡차/Cloudflare 감지 시 일시 정지하고 사용자에게 알림을 보냅니다.
*   **📝 누락 로그:** 다운로드 중 404 등으로 누락된 이미지가 있으면 `!MISSING_FILES_LOG.txt`를 생성하여 알려줍니다.


### 📡 서버 (API) - v1.1.0
*   **📦 대용량 이어 올리기:** 구글 드라이브 API의 Resumable Upload를 구현하여 용량 제한 없이 업로드 가능합니다.
*   **📂 ID 기반 폴더 관리:** 작품 제목이 바뀌어도 `[ID]`를 기준으로 동일한 폴더를 찾아냅니다.
*   **📊 메타데이터 관리:** `info.json`에 최신 회차, 파일 수, 썸네일 등을 자동으로 기록합니다.

### 📊 대시보드 (Dashboard) - v1.0.0
*   **🖥️ 웹 뷰어:** 수집한 만화를 웹에서 바로 검색하고 드라이브로 이동할 수 있습니다.
*   **🚀 초고속 로딩:** `library_index.json` 캐싱 및 SSR(Server-Side Rendering) 기술로 수천 개의 작품도 순식간에 로딩합니다.
*   **🌙 다크 모드:** 눈이 편안한 다크 테마 UI를 제공합니다.

-----

## ⚙️ 설치 가이드 (Installation)

이 프로젝트는 **1. API 서버**, **2. 대시보드**, **3. 클라이언트** 3가지 구성 요소로 이루어져 있습니다.

### 1️⃣ 1단계: API 서버 (TokiSync) 배포
1.  [Google Apps Script](https://script.google.com/)에서 새 프로젝트를 생성합니다.
2.  **`/google_app_script/TokiSync/`** 폴더의 `Code.gs` 내용을 복사해 붙여넣습니다.
3.  **프로젝트 설정(⚙️) > 스크립트 속성**에서 다음 항목을 추가합니다.
    *   `ROOT_FOLDER_ID`: 만화를 저장할 구글 드라이브 폴더 ID
    *   `SECRET_KEY`: 클라이언트와 통신할 비밀번호 (임의 설정)
4.  **배포 > 새 배포 > 웹 앱** 선택:
    *   액세스 권한 승인: **모든 사용자 (Anyone)** (필수!)
5.  생성된 **웹 앱 URL**을 복사해 둡니다. (API URL)

### 2️⃣ 2단계: 대시보드 (TokiView) 배포
1.  새 Apps Script 프로젝트를 생성합니다.
2.  **`/google_app_script/TokiView/`** 폴더의 `Code.gs`와 `Index.html` 내용을 복사해 붙여넣습니다.
3.  **프로젝트 설정(⚙️) > 스크립트 속성**에서 다음 항목을 추가합니다.
    *   `ROOT_FOLDER_ID`: (1단계와 동일한 폴더 ID)
4.  **배포 > 새 배포 > 웹 앱** 선택:
    *   액세스 권한 승인: **모든 사용자 (Anyone)**
5.  생성된 **웹 앱 URL**을 복사해 둡니다. (대시보드 URL)

### 3️⃣ 3단계: 클라이언트 (Tampermonkey) 설치
1.  브라우저에 [Tampermonkey](https://www.tampermonkey.net/) 확장 프로그램을 설치합니다.
2.  **`tokiSyncScript.js`** 파일의 전체 코드를 복사하여 새 스크립트로 저장합니다.
3.  웹툰 사이트(뉴토끼 등)에 접속합니다.
4.  Tampermonkey 메뉴 > **`⚙️ 설정 (URL/Key)`** 클릭:
    *   **API URL**: 1단계에서 복사한 URL
    *   **대시보드 URL**: 2단계에서 복사한 URL
    *   **Secret Key**: 1단계에서 설정한 비밀번호
5.  입력 후 저장하면 설치 완료!

-----

## � 마이그레이션 가이드 (Migration Guide)
**기존 사용자(v1.2.x 이하)**가 v1.6.2로 업데이트하는 방법입니다.

1.  **API 서버 업데이트 (필수)**
    *   기존 Apps Script 프로젝트를 열고, `Code.gs` 내용을 **`/google_app_script/TokiSync/Code.gs`** 내용으로 덮어씌웁니다.
    *   **중요**: 상단 `ROOT_FOLDER_ID` 변수가 사라졌으므로, **[프로젝트 설정 > 스크립트 속성]**에 `ROOT_FOLDER_ID`와 `SECRET_KEY`를 추가해야 합니다.
    *   **[배포 > 배포 관리]**에서 기존 배포를 수정(새 버전 생성)하여 업데이트합니다.

2.  **대시보드 추가 (선택)**
    *   새로운 기능인 **서재(Dashboard)**를 쓰려면, 위 **[설치 가이드 2단계]**를 따라 별도의 Apps Script 프로젝트를 생성하세요.

3.  **클라이언트 업데이트**
    *   Tampermonkey에서 기존 스크립트를 열고, **`tokiSyncScript.js`** 내용으로 덮어씌웁니다.
    *   메뉴의 **[⚙️ 설정]**에서 `대시보드 URL`을 추가로 입력해 주세요.

-----

## 📖 사용 방법 (Usage)

### ☁️ 자동 동기화
*   메뉴에서 `☁️ 자동 동기화` 클릭.
*   현재 페이지의 작품 목록과 드라이브를 비교해 **없는 회차만** 다운로드합니다.


### 📊 서재(대시보드) 열기
*   메뉴에서 `📊 서재 열기` 클릭.
*   수집된 모든 작품을 썸네일과 함께 볼 수 있습니다.
*   우측 상단 `🔄` 버튼을 눌러 인덱스를 최신화할 수 있습니다.

-----

## 📜 Version History
자세한 변경 내역은 [update_history.md](./update_history.md)를 참고하세요.

## 📜 License
[MIT License](./LICENSE). Use responsibly.
